<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Contact Form with Theme Toggle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      /* ===== Design tokens: LIGHT (default) ===== */
      :root {
        --bg: #f7f8fa;
        --panel: #ffffff;
        --text: #1a1a1a;
        --muted: #666;
        --primary: #2a6ae9;
        --primary-600: #1e56c7;
        --border: #e3e6eb;
        --focus: #7ab3ff;
        --radius: 12px;
        --shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      /* Respect OS setting initially (used only if user has no saved preference) */
      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0f1218;
          --panel: #151a22;
          --text: #f2f5f9;
          --muted: #b6c0cf;
          --border: #2a3240;
          --focus: #7ab3ff;
          --shadow: none;
        }
      }

      /* ===== Design tokens: DARK (forced override when data-theme="dark") ===== */
      html[data-theme="dark"] {
        --bg: #0f1218;
        --panel: #151a22;
        --text: #f2f5f9;
        --muted: #b6c0cf;
        --border: #2a3240;
        --focus: #7ab3ff;
        --shadow: none;
      }

      /* ===== Base layout/styles (from earlier form styling) ===== */
      html,
      body {
        height: 100%;
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, "Noto Sans", sans-serif;
        line-height: 1.5;
      }
      .container {
        max-width: 720px;
        margin: 4rem auto;
        padding: 0 1rem;
      }
      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      .card-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }
      .title {
        margin: 0;
        font-size: 1.5rem;
      }
      .subtitle {
        margin: 0.25rem 0 0;
        color: var(--muted);
        font-size: 0.95rem;
      }

      /* Theme toggle button */
      .theme-toggle {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--text);
        padding: 0.4rem 0.75rem;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 600;
      }
      .theme-toggle:hover {
        background: rgba(127, 127, 127, 0.08);
      }

      /* Form styles (shortened) */
      form {
        padding: 1.5rem;
        display: grid;
        gap: 1rem;
      }
      .field {
        display: grid;
        gap: 0.5rem;
      }
      label {
        font-weight: 600;
        font-size: 0.95rem;
      }
      .hint {
        color: var(--muted);
        font-size: 0.85rem;
        margin-top: -0.25rem;
      }
      input[type="text"],
      input[type="email"],
      select,
      textarea {
        width: 100%;
        padding: 0.7rem 0.85rem;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: transparent;
        color: inherit;
        transition: border-color 150ms ease, box-shadow 150ms ease;
      }
      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--focus);
        box-shadow: 0 0 0 3px color-mix(in oklab, var(--focus) 20%, transparent);
      }
      .actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
      }
      button[type="submit"] {
        appearance: none;
        border: none;
        border-radius: 999px;
        background: var(--primary);
        color: #fff;
        padding: 0.7rem 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 150ms ease, transform 80ms ease;
      }
      button[type="submit"]:hover {
        background: var(--primary-600);
      }
      button[type="submit"]:active {
        transform: translateY(1px);
      }
      .response {
        padding: 1.25rem 1.5rem;
        border-top: 1px solid var(--border);
      }
      .response h2 {
        margin: 0 0 0.75rem;
        font-size: 1.1rem;
      }
      pre {
        margin: 0;
        padding: 1rem;
        overflow: auto;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: color-mix(in oklab, var(--panel) 94%, black);
        color: inherit;
        max-height: 40vh;
      }
      @media (min-width: 640px) {
        .field {
          grid-template-columns: 180px 1fr;
          align-items: center;
        }
        .field .hint {
          grid-column: 2 / 3;
        }
      }
    </style>

    <script type="module">
      // ===== Theme initialisation =====
      const STORAGE_KEY = "theme"; // 'light' | 'dark'
      const root = document.documentElement;

      function getPreferredTheme() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved === "light" || saved === "dark") return saved;

        // No saved theme: follow OS preference
        const prefersDark = window.matchMedia?.(
          "(prefers-color-scheme: dark)"
        ).matches;
        return prefersDark ? "dark" : "light";
      }

      function applyTheme(theme) {
        if (theme === "dark") {
          root.setAttribute("data-theme", "dark");
        } else {
          root.removeAttribute("data-theme"); // fall back to light tokens
        }
        const label = document.getElementById("themeLabel");
        if (label) label.textContent = theme === "dark" ? "Dark" : "Light";
      }

      function setTheme(theme) {
        localStorage.setItem(STORAGE_KEY, theme);
        applyTheme(theme);
      }

      // Set at startup
      const initialTheme = getPreferredTheme();
      applyTheme(initialTheme);

      // Toggle handler (wired in DOMContentLoaded to ensure elements exist)
      window.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("themeToggle");
        if (btn) {
          btn.addEventListener("click", () => {
            const next =
              root.getAttribute("data-theme") === "dark" ? "light" : "dark";
            setTheme(next);
          });
        }
      });
    </script>
  </head>
  <body>
    <main class="container">
      <section class="card" aria-label="Contact form">
        <header class="card-header">
          <div>
            <h1 class="title">Contact Form</h1>
            <p class="subtitle">
              Submit your details and newsletter preference.
            </p>
          </div>

          <!-- Accessible theme toggle -->
          <button
            id="themeToggle"
            class="theme-toggle"
            type="button"
            aria-pressed="false"
            aria-label="Toggle color theme"
          >
            <span aria-hidden="true">ðŸŒ“</span>
            <span id="themeLabel">Light</span>
          </button>
        </header>

        <form id="contactForm" novalidate>
          <div class="field">
            <label for="name">Name</label>
            <div>
              <input
                id="name"
                name="name"
                type="text"
                placeholder="Jane Doe"
                required
                aria-required="true"
              />
              <p class="hint">Your full name.</p>
            </div>
          </div>

          <div class="field">
            <label for="email">Email</label>
            <div>
              <input
                id="email"
                name="email"
                type="email"
                placeholder="jane@example.com"
                required
                aria-required="true"
              />
              <p class="hint">Weâ€™ll only use this to send updates.</p>
            </div>
          </div>

          <div class="field">
            <label for="newsletter">Newsletter</label>
            <div>
              <select id="newsletter" name="newsletter">
                <option value="subscribe">Subscribe</option>
                <option value="unsubscribe">Unsubscribe</option>
              </select>
              <p class="hint">Choose whether to receive the newsletter.</p>
            </div>
          </div>

          <div class="field">
            <label for="message">Message</label>
            <div>
              <textarea
                id="message"
                name="message"
                rows="5"
                placeholder="Type your message..."
              ></textarea>
              <p class="hint">Optional: add a message for us.</p>
            </div>
          </div>

          <div class="actions">
            <button type="submit">Submit</button>
          </div>
        </form>

        <div class="response" aria-live="polite">
          <h2>Server Response</h2>
          <pre id="result" role="status"></pre>
        </div>
      </section>
    </main>

    <!-- Your existing ESM script that posts to /submit -->
    <script type="module">
      const form = document.getElementById("contactForm");
      const result = document.getElementById("result");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());

        try {
          const response = await fetch("/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const data = await response.json();
          result.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          result.textContent = JSON.stringify(
            { error: "Network or server error", details: String(err) },
            null,
            2
          );
        }
      });
    </script>
  </body>
</html>
